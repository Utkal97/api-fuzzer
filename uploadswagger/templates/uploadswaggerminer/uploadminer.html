<!DOCTYPE html>
<html lang="en">
<head>
    <title>Bootstrap Example</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        function handleButtonClick() {
    fetch('/runMinerFuzz/')
        .then(response => response.json())
        .then(data => {
            // Clear any existing content
            let responseContainer = document.getElementById('response-container');
            responseContainer.innerHTML = '';

            // Create the table structure
            let tableHTML = `<div class="container-fluid row">
                <div class="col-xs-5">
                    <table class="table table-striped" style="table-layout: auto;">
                        <thead>
                            <tr>
                                <th scope="col">#</th>
                                <th scope="col">Request</th>
                                <th scope="col">Response</th>
                                <th scope="col">Checker Name</th>
                                <th scope="col">Status Code</th>
                            </tr>
                        </thead>
                        <tbody>`;

            // Loop through the logs and add table rows
            data.logs.forEach((log, index) => {
                tableHTML += `<tr>
                                <th scope="row">${index + 1}</th>
                                <td style="max-width: 150px; word-break: break-word;">${log.endPoint}</td>
                                <td style="max-width: 150px; word-break: break-word;">${log.response}</td>
                                <td style="max-width: 150px; word-break: break-word;">${log.checker}</td>
                                <td style="max-width: 150px; word-break: break-word;">${log.statusCode}</td>
                              </tr>`;
            });

            tableHTML += `</tbody></table></div><div class="col-xs-7">jjjj</div></div>`;

            // Insert the HTML into the response container
            responseContainer.innerHTML = tableHTML;
        })
        .catch(error => console.error('Error:', error));
}

</script>
</head>
<body>

<nav class="navbar navbar-expand-sm bg-dark navbar-dark fixed-top">
    <div class="container-fluid">
        <a class="navbar-brand" href="#">MINER API Fuzzing Tool</a>
    </div>
</nav>
<br><br><br>
    <div class="container-fluid mt-5">
        <form method="post" enctype="multipart/form-data">
            {% csrf_token %}
            <div class="col-md-1"></div>
            <div class="col-md-7">
                <label for="swagger_file" class="form-label">Select the Swagger File to start Fuzzing!</label>
                <input class="form-control" type="file" id="swagger_file" name="swagger_file">
            </div>
            <div class="col-md-4"></div>
            <br>
            <button type="submit" class="btn btn-success">Upload & Compile</button>
<!--            {{ form.as_p }}-->
        </form>

        <!-- We have only given an option for Miner Fuzz because, that where the
         difference between RESTler and Fuzz is, we wanted to show in UI MINER Fuzz
         results also. So, This button will run the MINER fuzz in background with all the
         deep learning algorithms and gives the output in tabular format -->
        <br><br><button class="btn btn-primary" onclick="handleButtonClick()">Run Miner Fuzz</button>
            <div id="response-container"></div>
        </div>
    </div>
</body>
</html>
